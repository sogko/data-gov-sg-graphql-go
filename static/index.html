<!--
 *  Copyright (c) 2015, Facebook, Inc.
 *  All rights reserved.
 *
 *  This source code is licensed under the license found in the
 *  LICENSE file in the root directory of this source tree.
 *
-->
<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      height: 100%;
      margin: 0;
      width: 100%;
      overflow: hidden;
    }
    #graphiql {
      height: 100vh;
    }
  </style>
  <link rel="stylesheet" href="./graphiql.css" />
  <script src="//cdn.jsdelivr.net/fetch/0.9.0/fetch.min.js"></script>
  <script src="//cdn.jsdelivr.net/react/0.14.7/react.min.js"></script>
  <script src="//cdn.jsdelivr.net/react/0.14.7/react-dom.min.js"></script>
  <script src="/graphiql.min.js"></script>
</head>
<body>
<div id="graphiql">Loading...</div>
<script>

  /**
   * This GraphiQL example illustrates how to use some of GraphiQL's props
   * in order to enable reading and updating the URL parameters, making
   * link sharing of queries a little bit easier.
   *
   * This is only one example of this kind of feature, GraphiQL exposes
   * various React params to enable interesting integrations.
   */

  // Parse the search string to get url parameters.
  var search = window.location.search;
  var parameters = {};
  search.substr(1).split('&').forEach(function (entry) {
    var eq = entry.indexOf('=');
    if (eq >= 0) {
      parameters[decodeURIComponent(entry.slice(0, eq))] =
          decodeURIComponent(entry.slice(eq + 1));
    }
  });

  // if variables was provided, try to format it.
  if (parameters.variables) {
    try {
      parameters.variables =
          JSON.stringify(JSON.parse(parameters.variables), null, 2);
    } catch (e) {
      // Do nothing, we want to display the invalid JSON as a string, rather
      // than present an error.
    }
  }

  // When the query and variables string is edited, update the URL bar so
  // that it can be easily shared
  function onEditQuery(newQuery) {
    parameters.query = newQuery;
    updateURL();
  }

  function onEditVariables(newVariables) {
    parameters.variables = newVariables;
    updateURL();
  }

  function onEditOperationName(newOperationName) {
    parameters.operationName = newOperationName;
    updateURL();
  }

  function updateURL() {
    var newSearch = '?' + Object.keys(parameters).filter(function (key) {
          return Boolean(parameters[key]);
        }).map(function (key) {
          return encodeURIComponent(key) + '=' +
              encodeURIComponent(parameters[key]);
        }).join('&');
    history.replaceState(null, null, newSearch);
  }

  // Defines a GraphQL fetcher using the fetch API.
  function graphQLFetcher(graphQLParams) {
    return fetch(window.location.origin + '/graphql', {
      method: 'post',
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(graphQLParams),
      credentials: 'include',
    }).then(function (response) {
      return response.text();
    }).then(function (responseBody) {
      try {
        return JSON.parse(responseBody);
      } catch (error) {
        return responseBody;
      }
    });
  }

  // Render <GraphiQL /> into the body.

  ReactDOM.render(
      React.createElement(GraphiQL, {
        fetcher: graphQLFetcher,
        query: parameters.query,
        variables: parameters.variables,
        operationName: parameters.operationName,
        onEditQuery: onEditQuery,
        onEditVariables: onEditVariables,
        onEditOperationName: onEditOperationName,defaultQuery:
        "# Welcome to GraphiQL\n" +
        "#\n" +
        "# GraphiQL is an in-browser IDE for writing, validating, and\n" +
        "# testing GraphQL queries.\n" +
        "#\n" +
        "# Type queries into this side of the screen, and you will\n" +
        "# see intelligent typeaheads aware of the current GraphQL type schema and\n" +
        "# live syntax and validation errors highlighted within the text.\n" +
        "#\n" +
        "# To bring up the auto-complete at any point, just press Ctrl-Space.\n" +
        "#\n" +
        "# Press the run button above, or Cmd-Enter to execute the query, and the result\n" +
        "# will appear in the pane to the right.\n\n" +
        "{\n" +
        "  environment {\n" +
        "    # https://api.data.gov.sg/v1/environment/2-hour-weather-forecast\n" +
        "    two_hour_weather_forecast {\n" +
        "      items {\n" +
        "        valid_period {\n" +
        "          start\n" +
        "          end\n" +
        "        }\n" +
        "        forecasts {\n" +
        "          area {\n" +
        "            name\n" +
        "          }\n" +
        "          forecast\n" +
        "        }\n " +
        "     }\n" +
        "    }\n" +
        "  }\n" +
        "}"

      }),
      document.getElementById('graphiql')
  );
</script>
</body>
</html>
